
/*
 * ----------------------------------------------------------------------
 *  Copyright (C) 2006-2012 Numenta Inc. All rights reserved.
 *
 *  The information and source code contained herein is the
 *  exclusive property of Numenta Inc. No part of this software
 *  may be used, reproduced, stored or distributed in any form,
 *  without explicit written authorization from Numenta Inc.
 * ---------------------------------------------------------------------- */(function(a){a.GROK={}})(window);(function(a){a.GROK.util={toUriParams:function(a){var b="",c;for(c in a)a.hasOwnProperty(c)&&(b+=c+"="+encodeURIComponent(a[c])+"&");return b=b.substr(0,b.length-1),b},isSet:function(a){return a!==undefined&&a!==null},shallowObjectClone:function(a){return JSON.parse(JSON.stringify(a))},heir:function(a){function b(){}return b.prototype=a,new b}},a.GROK.LOG={ALL:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},a.GROK.LOG_LEVEL=a.GROK.LOG.ERROR,a.GROK.log=function(a){this.LOG_LEVEL<=this.LOG.ALL&&console.log(a)},a.GROK.debug=function(a){this.LOG_LEVEL<=this.LOG.DEBUG&&(console.debug?console.debug(a):console.log(a))},a.GROK.info=function(a){this.LOG_LEVEL<=this.LOG.INFO&&console.info(a)},a.GROK.warn=function(a){this.LOG_LEVEL<=this.LOG.WARN&&console.warn(a)},a.GROK.error=function(a){this.LOG_LEVEL<=this.LOG.ERROR&&console.error(a)}})(window);(function(a){function f(a,c,d){var e=c+"?";a.onerror=d.failure,a.onreadystatechange=function(b){a.readyState===4&&(b.error&&d.failure&&d.failure(new Error(b.error)),d.success(JSON.parse(b)))},d.data?e+=b.util.toUriParams(d.data)+"&callback=?":e+="callback=?",a.open(null,e),a.send()}function g(a,b,f){var g,h,i=this._xhr,j=this._proxyEndpoint||d,k=this._apiKey;f.failure=f.failure||function(){},i.open(c,j),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.setRequestHeader(e,"1");for(h in f.headers)f.headers.hasOwnProperty(h)&&i.setRequestHeader(h,f.headers[h]);i.onreadystatechange=function(){var a;if(this.readyState==4&&this.status==200){if(f.success)if(this.responseText){try{a=JSON.parse(this.responseText)}catch(b){f.failure(new Error("Could not parse response text from API server: "+this.responseText))}a.errors?f.failure(new Error(a.errors[0])):f.success(a)}else f.success()}else this.readyState==4&&this.status!=200&&f.failure&&f.failure(new Error("There was an XHR error, status is: "+this.status))},g={proxy:{method:b,endpoint:a}},k&&(g.apiKey=k),f.data&&(g.proxy.data=f.data),i.send(JSON.stringify(g))}function h(a,b){return b.forceProxy?!1:a==="GET"}var b=a.GROK,c="POST",d="/grok",e="x-grok";b.Request=function(c){var d=c.endpoint,e=c.version,f=c.apiKey,g=c.proxyEndpoint,h="";if(!d||!e)throw new Error("Cannot create GROK.Request object without endpoint and version: \"new GROK.Request('/endpoint', 'version'\"");this._apiKey=f,this._proxyEndpoint=g,this._xhr=new XMLHttpRequest,this._jxhr=new a.jXHR,d.substr(d.length-1,1)!=="/"&&(h="/"),this._root=d+h+e,this.constructor=b.Request},b.Request.prototype.send=function(a){var b=a.method||"GET",c=a.url||this._root+"/"+a.path;b=b.toUpperCase(),h(b,a)?f(this._jxhr,c,a):g.call(this,c,b,a)}})(window);(function(a){var b=a.GROK,c={ENDPOINT:"http://grok-api.numenta.com/",VERSION:"v1",FORCE_PROXY:!1};b.ApiObject=function(a,b){b=b||{},a=a||{},this.setScalars(a),this.setEndpoint(b.endpoint||c.ENDPOINT),this.setProxyEndpoint(b.proxyEndpoint),this.setVersion(b.version||c.VERSION),this.setHeaders(b.httpHeaders||{}),this.setUserId(b.userId),this.setApiKey(b.apiKey)},b.ApiObject.FORCE_PROXY=c.FORCE_PROXY,b.ApiObject.prototype.setScalar=function(a,b){this._scalars[a]=b},b.ApiObject.prototype.setScalars=function(a,b){var c;typeof b=="undefined"&&(b=!0);if(b)this._scalars=a;else for(c in a)this._scalars[c]=a[c]},b.ApiObject.prototype.getScalars=function(){return this._scalars||{}},b.ApiObject.prototype.getScalar=function(a){return this._scalars[a]},b.ApiObject.prototype.setDetails=function(a){this._details=a},b.ApiObject.prototype.setDetail=function(a,b){this._details[a]=b},b.ApiObject.prototype.getDetails=function(){return this._details||{}},b.ApiObject.prototype.getDetail=function(a){return this._details[a]},b.ApiObject.prototype.hasDetails=function(){return b.util.isSet(this._details)},b.ApiObject.prototype.getAttrs=function(){var a=this._scalars,b=this._details,c={},d;for(d in a)a.hasOwnProperty(d)&&d.indexOf("_")!==0&&(c[d]=a[d]);for(d in b)b.hasOwnProperty(d)&&d.indexOf("_")!==0&&(c[d]=b[d]);return c},b.ApiObject.prototype.getAttr=function(a){return this.getAttrs()[a]},b.ApiObject.prototype.get=function(a){var b=this._scalars[a];return!b&&this._details&&(b=this._details[a]),b},b.ApiObject.prototype.getId=function(){return this.get("id")},b.ApiObject.prototype.setEndpoint=function(a){this._apiEndpoint=a},b.ApiObject.prototype.setProxyEndpoint=function(a){this._proxyEndpoint=a},b.ApiObject.prototype.getProxyEndpoint=function(){return this._proxyEndpoint},b.ApiObject.prototype.getEndpoint=function(){return this._apiEndpoint},b.ApiObject.prototype.setVersion=function(a){this._apiVersion=a},b.ApiObject.prototype.getVersion=function(){return this._apiVersion},b.ApiObject.prototype.setUserId=function(a){this._userId=a},b.ApiObject.prototype.getUserId=function(){return this._userId},b.ApiObject.prototype.setApiKey=function(a){this._apiKey=a},b.ApiObject.prototype.getApiKey=function(){return this._apiKey},b.ApiObject.prototype.setHeaders=function(a){this._httpHeaders=a||{}},b.ApiObject.prototype.getHeaders=function(){return this._httpHeaders},b.ApiObject.prototype.expand=function(a,c){b.debug("ApiObject.expand for "+this.constructor.NAMESPACE);var d=this,e=a.NAMESPACE,f=e.substr(0,e.length-1),g=this.get("url");b.debug("Expanding "+f),this.makeRequest({method:"GET",url:g,success:function(a){var b=a[f];d.setDetails(b),c(null,d.getDetails())},failure:function(a){c(a)}})},b.ApiObject.prototype.delete=function(a){b.debug("ApiObject.delete for "+this.constructor.NAMESPACE);var c=this;this.makeRequest({method:"DELETE",url:this.get("url"),success:function(){var b;for(b in c)delete c[b];a()},failure:function(b){a(b)}})},b.ApiObject.prototype.makeRequest=function(c){b.info("GROK.ApiObject.makeRequest for "+this.constructor.NAMESPACE),b.debug(c);var d,e,f=b.util.shallowObjectClone(this._httpHeaders);if(!c.url&&!c.path){e=new Error('Cannot make request without an absolute "url" or relative "path".');if(c.failure){c.failure(e);return}throw e}if(!c.headers)c.headers=f;else for(d in f)c.headers[d]||(c.headers[d]=f[d]);b.util.isSet(c.forceProxy)||(c.forceProxy=b.ApiObject.FORCE_PROXY),(new a.GROK.Request({endpoint:this.getEndpoint(),version:this.getVersion(),apiKey:this.getApiKey(),proxyEndpoint:this.getProxyEndpoint()})).send(c)},b.ApiObject.prototype.listObjects=function(){b.debug("GROK.ApiObject.listObjects for "+this.constructor.NAMESPACE);var a=arguments[0],c=typeof arguments[1]=="function"?{}:arguments[1],d=typeof arguments[1]=="function"?arguments[1]:arguments[2],e=this,f=a.NAMESPACE,g=this.get(f+"Url");this.makeRequest({method:"GET",url:g,data:c,success:function(b){var c=0,g=b[f];for(;c<g.length;c++)g[c]=new a(g[c],e.getDefaultChildOptions()),g[c].setScalar("_parent",e);d(null,g)},failure:function(a){d(a)}})},b.ApiObject.prototype.createObject=function(a,c,d){b.debug("GROK.ApiObject.createObject for "+this.constructor.NAMESPACE);var e=this,f=a.NAMESPACE,g=f.substr(0,f.length-1),h={};h[g]=c,this.makeRequest({method:"POST",url:this.get(f+"Url"),data:h,success:function(b){var c=new a(b[g],e.getDefaultChildOptions());c.setScalar("_parent",e),d(null,c)},failure:function(a){d(a)}})},b.ApiObject.prototype.getObject=function(a,c,d){b.debug("GROK.ApiObject.getObject for "+this.constructor.NAMESPACE);var e=this,f=a.NAMESPACE,g=f.substr(0,f.length-1);this.makeRequest({method:"GET",url:this.get(f+"Url")+"/"+c,success:function(b){d(null,new a(b[g],e.getDefaultChildOptions()))},failure:function(a){d(a)}})},b.ApiObject.prototype.updateObject=function(a,c,d){b.debug("GROK.ApiObject.updateObject for "+this.constructor.NAMESPACE);var e=this,f,g=a.NAMESPACE,h=g.substr(0,g.length-1),i,j={};i=e.getAttrs();for(f in c)c.hasOwnProperty(f)&&(i[f]=c[f]);j[h]=i,this.makeRequest({method:"POST",url:this.get("url"),data:j,success:function(){e.setScalars(i,!1),d()},failure:function(a){d(a)}})},b.ApiObject.prototype.getDefaultChildOptions=function(){return{endpoint:this.getEndpoint(),proxyEndpoint:this.getProxyEndpoint(),version:this.getVersion(),headers:this.getHeaders(),userId:this.getUserId(),apiKey:this.getApiKey()}}})(window);(function(a){var b=a.GROK;b.Stream=function(a,c){b.ApiObject.apply(this,arguments),this.constructor=b.Stream},b.Stream.prototype=b.util.heir(b.ApiObject.prototype),b.Stream.prototype.constructor=b.ApiObject,b.Stream.NAMESPACE="streams",b.Stream.prototype.populate=function(a){this.expand(b.Stream,a)},b.Stream.prototype.addData=function(a,b){this.makeRequest({method:"POST",url:this.get("dataUrl"),data:{input:a},success:function(){b()},failure:function(a){b(a)}})},b.Stream.prototype.getInputData=function(a){this.makeRequest({method:"GET",url:this.get("dataUrl"),success:function(b){a(null,b.data)},failure:function(b){a(b)}})}})(window);(function(a){var b=a.GROK;b.Model=function(a,c){b.ApiObject.apply(this,arguments),this.constructor=b.Model},b.Model.prototype=b.util.heir(b.ApiObject.prototype),b.Model.prototype.constructor=b.ApiObject,b.Model.NAMESPACE="models",b.Model.prototype.getName=function(){return this.getScalar("name")},b.Model.prototype.populate=function(a){this.expand(b.Model,a)},b.Model.prototype.update=function(a,c){this.updateObject(b.Model,a,c)},b.Model.prototype.clone=function(a){var b=this,c=this.getScalar("_parent"),d=this.getAttrs();this.hasDetails()||this.populate(function(c){c?a(c):d=b.getAttrs()}),d.aggregation||(d.aggregation={interval:"seconds"}),c.createModel(d,a)},b.Model.prototype.getOutputData=function(a){this.makeRequest({url:this.get("dataUrl"),success:function(b){a(null,b.output)},failure:function(b){a(b)}})},b.Model.prototype.listSwarms=function(a){this.makeRequest({method:"GET",url:this.get("swarmsUrl"),success:function(b){a(null,b.swarms)},failure:function(b){a(b)}})}})(window);(function(a){var b=a.GROK;b.Project=function(a,c){b.ApiObject.apply(this,arguments),this.constructor=b.Project},b.Project.prototype=b.util.heir(b.ApiObject.prototype),b.Project.prototype.constructor=b.ApiObject,b.Project.NAMESPACE="projects",b.Project.prototype.getId=function(){return this.getScalar("id")},b.Project.prototype.getName=function(){return this.getScalar("name")},b.Project.prototype.getDescription=function(a){var b=this,c=this.getAttr("description");c?a(null,c):this.populate(function(c){c?a(c):a(null,b.getDetail("description"))})},b.Project.prototype.setName=function(a,b){this.update({name:a},b)},b.Project.prototype.update=function(a,c){this.updateObject(b.Project,a,c)},b.Project.prototype.listModels=function(a){this.listObjects(b.Model,a)},b.Project.prototype.listStreams=function(a){this.listObjects(b.Stream,a)},b.Project.prototype.createModel=function(a,c){c=c||function(){},this.createObject(b.Model,a,c)},b.Project.prototype.createStream=function(a,c){c=c||function(){},this.createObject(b.Stream,a,c)},b.Project.prototype.populate=function(a){this.expand(b.Project,a)}})(window);(function(a){var b=a.GROK;b.Client=function(a,c){this._validated=!1;if(!b.util.isSet(a))throw new Error('Cannot create GROK Client without an API Key:\nnew GROK.Client("my-api-key");');c=c||{},c.apiKey=a,b.ApiObject.call(this,{},c),c.user&&c.user.id&&(this.setScalars(c.user),this._validated=!0),this.constructor=b.Client},b.Client.prototype=b.util.heir(b.ApiObject.prototype),b.Client.prototype.constructor=b.ApiObject,b.Client.NAMESPACE="users",b.Client.prototype.init=function(a){var b=this;this.makeRequest({method:"GET",path:"users",success:function(c){b.setScalars(c.users[0]),b._validated=!0,a(null)},failure:function(c){if(c.message!=="Unauthorized")throw c;a(new Error('Invalid API key: "'+b.getApiKey()+'"'))}})},b.Client.prototype.showServices=function(a){this.makeRequest({path:"services",success:function(b){a(null,b)},failure:function(b){a(b)}})},b.Client.prototype.systemStatus=function(a){this.makeRequest({path:"admin",success:function(b){a(null,b)},failure:function(b){a(b)}})},b.Client.prototype.isValidated=function(){return this._validated},b.Client.prototype.createProject=function(a,c){c=c||function(){},this.createObject(b.Project,{name:a},c)},b.Client.prototype.createStream=function(a,c){c=c||function(){},this.createObject(b.Stream,a,c)},b.Client.prototype.createModel=function(a,c){c=c||function(){},this.createObject(b.Model,a,c)},b.Client.prototype.getProject=function(a,c){this.getObject(b.Project,a,c)},b.Client.prototype.listProjects=function(a){this.listObjects(b.Project,a)},b.Client.prototype.listModels=function(a){this.listObjects(b.Model,{all:!0},a)},b.Client.prototype.listStreams=function(a){this.listObjects(b.Stream,a)}})(window);(function(a){var b=a.setTimeout,c=a.document,d=0;a.jXHR=function(){function i(){try{g.parentNode.removeChild(g)}catch(a){}}function j(){f=!1,e="",i(),g=null,m(0)}function k(a){try{h.onerror.call(h,a,e)}catch(b){throw new Error(a)}}function l(){if(this.readyState&&this.readyState!=="complete"&&this.readyState!=="loaded"||f)return;this.onload=this.onreadystatechange=null,f=!0,h.readyState!==4&&k("Script failed to load ["+e+"]."),i()}function m(a,b){b=b||[],h.readyState=a,typeof h.onreadystatechange=="function"&&h.onreadystatechange.apply(h,b)}var e,f,g,h=null;return h={onerror:null,onreadystatechange:null,readyState:0,open:function(b,c){j(),internal_callback="cb"+d++,function(b){a.jXHR[b]=function(){try{m.call(h,4,arguments)}catch(c){h.readyState=-1,k("Script failed to run ["+e+"].")}a.jXHR[b]=null}}(internal_callback),e=c.replace(/=\?/,"=jXHR."+internal_callback),m(1)},send:function(){b(function(){g=c.createElement("script"),g.setAttribute("type","text/javascript"),g.onload=g.onreadystatechange=function(){l.call(g)},g.setAttribute("src",e),c.getElementsByTagName("head")[0].appendChild(g)},0),m(2)},setRequestHeader:function(){},getResponseHeader:function(){return""},getAllResponseHeaders:function(){return[]}},j(),h}})(window);