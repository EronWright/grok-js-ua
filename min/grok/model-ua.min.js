/*
 * ----------------------------------------------------------------------
 *  Copyright (C) 2006-2012 Numenta Inc. All rights reserved.
 *
 *  The information and source code contained herein is the
 *  exclusive property of Numenta Inc. No part of this software
 *  may be used, reproduced, stored or distributed in any form,
 *  without explicit written authorization from Numenta Inc.
 * ---------------------------------------------------------------------- */(function(a){var b=a.GROK,c=1e3,d=500;b.Model=function(a,c){c=c||{},c.promotionInterval===undefined&&(this.promotionInterval=d),b.ApiObject.apply(this,arguments),this.constructor=b.Model},b.Model.prototype=b.util.heir(b.ApiObject.prototype),b.Model.prototype.constructor=b.ApiObject,b.Model.NAMESPACE="models",b.Model.prototype.getName=function(){return this.getAttr("name")},b.Model.prototype.clone=function(a){var b=this,c=this.getScalar("_parent");this.hasDetails()?c.createModel(b.getAttrs(),a):this.populate(function(d){d?a(d):c.createModel(b.getAttrs(),a)})},b.Model.prototype.getStream=function(a){var b=this.get("streamId"),c=this.get("_parent");c.getStream(b,a)},b.Model.prototype.getOutputData=function(a,b){var c=this,d,e,f;typeof a=="function"?d=a:(e=a.limit||1e3,f=a.shift||!1,d=b),this.makeRequest({data:{limit:e,shift:f},url:this.get("dataUrl"),success:function(a){var b=a.output||{data:[],names:[],meta:{}};d(null,b)},failure:function(a){d(a)}})},b.Model.prototype.monitorPredictions=function(a){var c;return a=a||{},a.interval=a.interval||1e3,a.timeout=a.timeout||30,c=new b.PredictionMonitor(this,{debug:a.debug,interval:a.interval,outputDataOptions:a.outputDataOptions,timeout:a.timeout,lastRowIdSeen:a.startAt}),a.onUpdate&&c.onData(a.onUpdate),a.onDone&&c.onDone(a.onDone),a.onError&&c.onError(a.onError),c.start(),c},b.Model.prototype.listSwarms=function(a){this.makeRequest({method:"GET",url:this.get("swarmsUrl"),success:function(b){a(null,b.swarms)},failure:function(b){a(b)}})},b.Model.prototype.startSwarm=function(a,d){var e=this,f,g,h,i;typeof a=="function"?f=a:(g=a.size||"medium",h=a.interval||c,i=a.debug,f=d),this.makeRequest({method:"POST",data:{options:{size:g}},url:this.get("swarmsUrl"),success:function(a,c){var d=a.swarm,g=new b.Swarm(d,{rawJSON:c});d._parent=e,f(null,g,new b.SwarmMonitor(g,{interval:h,debug:i}))},failure:function(a){f(a)}})},b.Model.prototype.stopSwarm=function(a){var c=this;this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"stop"},success:function(){c.setScalar("status",b.Swarm.STOPPED),a()},failure:function(b){a(b)}})},b.Model.prototype.getSwarm=function(a,c){this.makeRequest({method:"GET",url:this.get("swarmsUrl")+"/"+a,success:function(a,d){c(null,new b.Swarm(a.swarm,{rawJSON:d}))},failure:function(a){c(a)}})},b.Model.prototype.listCheckpoints=function(a){this.makeRequest({method:"GET",url:this.get("checkpointsUrl"),success:function(b){a(null,b.checkpoints)},failure:function(b){a(b)}})},b.Model.prototype.createCheckpoint=function(a){this.makeRequest({method:"POST",url:this.get("checkpointsUrl"),success:function(b){a(null,b.checkpoint)},failure:function(b){a(b)}})},b.Model.prototype.promote=function(a){function e(){var e=setInterval(function(){b.getOutputData(function(b,f){if(b)return a(b);!c&&f.data.length>=d&&(clearInterval(e),a(),c=!0)})},b.promotionInterval)}function f(){b.getOutputData(function(c,f){var g;if(c)return a(c);d=f.data.length,g=setInterval(function(){b.populate(function(b,c){if(b)return a(b);c.status==="running"&&(clearInterval(g),e())})},b.promotionInterval)})}var b=this,c,d;this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"promote"},success:function(){f()},failure:function(b){a(b)}})}})(window);