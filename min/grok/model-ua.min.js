/*
 * ----------------------------------------------------------------------
 *  Copyright (C) 2006-2012 Numenta Inc. All rights reserved.
 *
 *  The information and source code contained herein is the
 *  exclusive property of Numenta Inc. No part of this software
 *  may be used, reproduced, stored or distributed in any form,
 *  without explicit written authorization from Numenta Inc.
 * ---------------------------------------------------------------------- */(function(a){var b=a.GROK,c=1e3,d=500;b.Model=function(a,c){b.ApiObject.apply(this,arguments),this.constructor=b.Model},b.Model.prototype=b.util.heir(b.ApiObject.prototype),b.Model.prototype.constructor=b.ApiObject,b.Model.NAMESPACE="models",b.Model.prototype.getName=function(){return this.getScalar("name")},b.Model.prototype.clone=function(a){var b=this,c=this.getScalar("_parent"),d=this.getAttrs();this.hasDetails()||this.populate(function(c){c?a(c):d=b.getAttrs()}),d.aggregation||(d.aggregation={interval:"seconds"}),c.createModel(d,a)},b.Model.prototype.getStream=function(a){var b=this.get("streamId"),c=this.get("_parent");c.getStream(b,a)},b.Model.prototype.getOutputData=function(a,b){var c=this,d,e,f;typeof a=="function"?d=a:(e=a.limit||1e3,f=a.align,d=b),this.makeRequest({data:{limit:e},url:this.get("dataUrl"),success:function(a){var b=a.output;f&&(b=c.alignOutputData(b)),d(null,b)},failure:function(a){d(a)}})},b.Model.prototype.listSwarms=function(a){this.makeRequest({method:"GET",url:this.get("swarmsUrl"),success:function(b){a(null,b.swarms)},failure:function(b){a(b)}})},b.Model.prototype.startSwarm=function(a,d){var e=this,f,g;typeof a=="function"?f=a:(g=a.size||"medium",f=d),this.makeRequest({method:"POST",data:{options:{size:g}},url:this.get("swarmsUrl"),success:function(a){var d=a.swarm,g=new b.Swarm(d);d._parent=e,f(null,g,new b.SwarmMonitor(g,c))},failure:function(a){f(a)}})},b.Model.prototype.stopSwarm=function(a){this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"stop"},success:function(){a()},failure:function(b){a(b)}})},b.Model.prototype.getSwarm=function(a,c){this.makeRequest({method:"GET",url:this.get("swarmsUrl")+"/"+a,success:function(a){c(null,new b.Swarm(a.swarm))},failure:function(a){c(a)}})},b.Model.prototype.alignOutputData=function(a){var b=a.names,c=a.data,d=[],e,f,g,h=[];b.forEach(function(a,b){(a.match("Metric temporal")||a.match("Predicted"))&&h.push(b)}),c.length&&c[0].forEach(function(){d.push("")}),c.push(d);for(e=c.length-1;e>=0;e--)g=c[e],f=[],e!==c.length-1&&h.forEach(function(a){var b=g[a];c[e+1][a]=b,e===0&&(c[e][a]="")});return c.unshift(b),c},b.Model.prototype.monitorPredictions=function(a){var c;a=a||{},a.pollFrequency=a.pollFrequency||1e3,a.limit=a.limit||3e3,a.lastRowIdSeen=a.startAt,c=new b.PredictionMonitor(this,{interval:a.pollFrequency,limit:a.limit,lastRowIdSeen:a.lastRowIdSeen}),a.onUpdate&&c.onData(a.onUpdate),a.onDone&&c.onDone(a.onDone),c.start()},b.Model.prototype.promote=function(a){function f(){var f=setInterval(function(){b.getOutputData(function(b,d){if(b)return a(b);!c&&d.data.length>=e&&(clearInterval(f),a(),c=!0)})},d)}function g(){b.getOutputData(function(c,g){var h;if(c)return a(c);e=g.data.length,h=setInterval(function(){b.populate(function(b,c){if(b)return a(b);c.status==="running"&&(clearInterval(h),f())})},d)})}var b=this,c,e;this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"promote"},success:function(){g()},failure:function(b){a(b)}})}})(window);