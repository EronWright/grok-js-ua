/*
 * ----------------------------------------------------------------------
 *  Copyright (C) 2006-2012 Numenta Inc. All rights reserved.
 *
 *  The information and source code contained herein is the
 *  exclusive property of Numenta Inc. No part of this software
 *  may be used, reproduced, stored or distributed in any form,
 *  without explicit written authorization from Numenta Inc.
 * ---------------------------------------------------------------------- */(function(a){var b=a.GROK,c=500;b.Model=function(a,c){b.ApiObject.apply(this,arguments),this.constructor=b.Model},b.Model.prototype=b.util.heir(b.ApiObject.prototype),b.Model.prototype.constructor=b.ApiObject,b.Model.NAMESPACE="models",b.Model.prototype.getName=function(){return this.getScalar("name")},b.Model.prototype.clone=function(a){var b=this,c=this.getScalar("_parent"),d=this.getAttrs();this.hasDetails()||this.populate(function(c){c?a(c):d=b.getAttrs()}),d.aggregation||(d.aggregation={interval:"seconds"}),c.createModel(d,a)},b.Model.prototype.getStream=function(a){var b=this.get("streamId"),c=this.get("_parent");c.getStream(b,a)},b.Model.prototype.getOutputData=function(a){this.makeRequest({url:this.get("dataUrl"),success:function(b){a(null,b.output)},failure:function(b){a(b)}})},b.Model.prototype.listSwarms=function(a){this.makeRequest({method:"GET",url:this.get("swarmsUrl"),success:function(b){a(null,b.swarms)},failure:function(b){a(b)}})},b.Model.prototype.startSwarm=function(a){var c=this;this.makeRequest({method:"POST",url:this.get("swarmsUrl"),success:function(d){var e=d.swarm;e._parent=c,a(null,new b.Swarm(e))},failure:function(b){a(b)}})},b.Model.prototype.stopSwarm=function(a){this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"stop"},success:function(){a()},failure:function(b){a(b)}})},b.Model.prototype.getSwarm=function(a,c){this.makeRequest({method:"GET",url:this.get("swarmsUrl")+"/"+a,success:function(a){c(null,new b.Swarm(a.swarm))},failure:function(a){c(a)}})},b.Model.prototype.alignOutputData=function(a){var b=a.names,c=a.data,d=[],e,f,g,h=[];b.forEach(function(a,b){(a.match("Metric temporal")||a.match("Predicted"))&&h.push(b)}),c[0].forEach(function(){d.push("")}),c.push(d);for(e=c.length-1;e>=0;e--)g=c[e],f=[],e!==c.length-1&&h.forEach(function(a){var b=g[a];c[e+1][a]=b,e===0&&(c[e][a]="")});return c.unshift(b),c},b.Model.prototype.promote=function(a){function e(){var e,f=setInterval(function(){b.getOutputData(function(b,c){if(b)return a(b);!e&&c.data.length>=d&&(clearInterval(f),a(),e=!0)})},c)}function f(){b.getOutputData(function(f,g){var h;if(f)return a(f);d=g.data.length,h=setInterval(function(){b.populate(function(b,c){if(b)return a(b);c.status==="running"&&(clearInterval(h),e())})},c)})}var b=this,d;this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"promote"},success:function(){f()},failure:function(b){a(b)}})}})(window);