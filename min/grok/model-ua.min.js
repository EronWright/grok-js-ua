(function(global){var GROK=global.GROK,DEFAULT_SWARM_MONITOR_INTERVAL=1e3,DEFAULT_PROMOTION_INTERVAL=500;GROK.Model=function(attrs,options){options=options||{};if(options.promotionInterval===undefined){this.promotionInterval=DEFAULT_PROMOTION_INTERVAL}GROK.ApiObject.apply(this,arguments);this.constructor=GROK.Model};GROK.Model.prototype=GROK.util.heir(GROK.ApiObject.prototype);GROK.Model.prototype.constructor=GROK.ApiObject;GROK.Model.NAMESPACE="models";GROK.Model.prototype.getName=function(){return this.getAttr("name")};GROK.Model.prototype.clone=function(callback){var me=this,parent=this.getScalar("_parent");if(!this.hasDetails()){this.populate(function(err){if(err){callback(err)}else{parent.createModel(me.getAttrs(),callback)}})}else{parent.createModel(me.getAttrs(),callback)}};GROK.Model.prototype.getStream=function(callback){var streamId=this.get("streamId"),parent=this.get("_parent");parent.getStream(streamId,callback)};GROK.Model.prototype.getOutputData=function(opts,callback){var me=this,cb,limit,shift;if(typeof opts==="function"){cb=opts}else{limit=opts.limit||1e3;shift=opts.shift||false;cb=callback}this.makeRequest({data:{limit:limit,shift:shift},url:this.get("dataUrl"),success:function(data){var output=data.output||{data:[],names:[],meta:{}};cb(null,output)},failure:function(err){cb(err)}})};GROK.Model.prototype.monitorPredictions=function(opts){var monitor;opts=opts||{};opts.interval=opts.interval||1e3;opts.timeout=opts.timeout||30;monitor=new GROK.PredictionMonitor(this,{debug:opts.debug,interval:opts.interval,outputDataOptions:opts.outputDataOptions,timeout:opts.timeout,lastRowIdSeen:opts.startAt});if(opts.onUpdate){monitor.onData(opts.onUpdate)}if(opts.onDone){monitor.onDone(opts.onDone)}if(opts.onError){monitor.onError(opts.onError)}monitor.start();return monitor};GROK.Model.prototype.listSwarms=function(callback){this.makeRequest({method:"GET",url:this.get("swarmsUrl"),success:function(data){callback(null,data.swarms)},failure:function(err){callback(err)}})};GROK.Model.prototype.startSwarm=function(opts,callback){var me=this,cb,size,interval,debug;if(typeof opts==="function"){cb=opts}else{size=opts.size||GROK.Swarm.SIZE.MEDIUM;interval=opts.interval||DEFAULT_SWARM_MONITOR_INTERVAL;debug=opts.debug;cb=callback}this.makeRequest({method:"POST",data:{options:{size:size}},url:this.get("swarmsUrl"),success:function(data,respText){var swarmAttrs=data.swarm,swarm=new GROK.Swarm(swarmAttrs,{rawJSON:respText});swarmAttrs._parent=me;cb(null,swarm,new GROK.SwarmMonitor(swarm,{interval:interval,debug:debug}))},failure:function(err){cb(err)}})};GROK.Model.prototype.stopSwarm=function(callback){var me=this;this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"stop"},success:function(){me.setScalar("status",GROK.Swarm.STOPPED);callback()},failure:function(err){callback(err)}})};GROK.Model.prototype.start=function(callback){var me=this;this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"start"},success:function(){me.setScalar("status",GROK.Swarm.RUNNING);callback()},failure:function(err){callback(err)}})};GROK.Model.prototype.getSwarm=function(swarmId,callback){this.makeRequest({method:"GET",url:this.get("swarmsUrl")+"/"+swarmId,success:function(data,respText){callback(null,new GROK.Swarm(data.swarm,{rawJSON:respText}))},failure:function(err){callback(err)}})};GROK.Model.prototype.listCheckpoints=function(callback){this.makeRequest({method:"GET",url:this.get("checkpointsUrl"),success:function(data){callback(null,data.checkpoints)},failure:function(err){callback(err)}})};GROK.Model.prototype.createCheckpoint=function(callback){this.makeRequest({method:"POST",url:this.get("checkpointsUrl"),success:function(data){callback(null,data.checkpoint)},failure:function(err){callback(err)}})};GROK.Model.prototype.promote=function(callback){var me=this,callbackCalled,initialOutputLength;function whenRunning(){var passedCacheInterval=setInterval(function(){me.getOutputData(function(err,outputData){if(err){return callback(err)}if(!callbackCalled&&outputData.data.length>=initialOutputLength){clearInterval(passedCacheInterval);callback();callbackCalled=true}})},me.promotionInterval)}function afterPromotion(){me.getOutputData(function(err,outputData){var runningInterval;if(err){return callback(err)}initialOutputLength=outputData.data.length;runningInterval=setInterval(function(){me.populate(function(err,modelDetails){if(err){return callback(err)}if(modelDetails.status==="running"&&runningInterval){clearInterval(runningInterval);runningInterval=null;whenRunning()}})},me.promotionInterval)})}this.makeRequest({method:"POST",url:this.get("commandsUrl"),data:{command:"promote"},success:function(){afterPromotion()},failure:function(err){callback(err)}})}})(window);