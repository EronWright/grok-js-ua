/*
 * ----------------------------------------------------------------------
 *  Copyright (C) 2006-2012 Numenta Inc. All rights reserved.
 *
 *  The information and source code contained herein is the
 *  exclusive property of Numenta Inc. No part of this software
 *  may be used, reproduced, stored or distributed in any form,
 *  without explicit written authorization from Numenta Inc.
 * ---------------------------------------------------------------------- *//******************************************************************************
 * This file needs jXHR.js: http://mulletxhr.com
 *  requires ./third/jXHR.js
 *****************************************************************************/(function(a){function f(a,c,d){var e=c+"?";a.onerror=d.failure,a.onreadystatechange=function(b){a.readyState===4&&(b.error&&d.failure&&d.failure(new Error(b.error)),d.success(JSON.parse(b)))},d.data?e+=b.util.toUriParams(d.data)+"&callback=?":e+="callback=?",a.open(null,e),a.send()}function g(a,b,f){var g,h,i=this._xhr,j=this._proxyEndpoint||d,k=this._apiKey;f.failure=f.failure||function(){},i.open(c,j),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.setRequestHeader(e,"1");for(h in f.headers)f.headers.hasOwnProperty(h)&&i.setRequestHeader(h,f.headers[h]);i.onreadystatechange=function(){var a;if(this.readyState==4&&this.status==200){if(f.success)if(this.responseText){try{a=JSON.parse(this.responseText)}catch(b){f.failure(new Error("Could not parse response text from API server: "+this.responseText))}a.errors?f.failure(new Error(a.errors[0])):f.success(a)}else f.success()}else this.readyState==4&&this.status!=200&&f.failure&&f.failure(new Error("There was an XHR error, status is: "+this.status))},g={proxy:{method:b,endpoint:a}},k&&(g.apiKey=k),f.data&&(g.proxy.data=f.data),i.send(JSON.stringify(g))}function h(a,b){return b.forceProxy?!1:a==="GET"}var b=a.GROK,c="POST",d="/grok",e="x-grok";b.Request=function(c){var d=c.endpoint,e=c.version,f=c.apiKey,g=c.proxyEndpoint,h="";if(!d||!e)throw new Error("Cannot create GROK.Request object without endpoint and version: \"new GROK.Request('/endpoint', 'version'\"");this._apiKey=f,this._proxyEndpoint=g,this._xhr=new XMLHttpRequest,this._jxhr=new a.jXHR,d.substr(d.length-1,1)!=="/"&&(h="/"),this._root=d+h+e,this.constructor=b.Request},b.Request.prototype.send=function(a){var b=a.method||"GET",c=a.url||this._root+"/"+a.path;b=b.toUpperCase(),h(b,a)?f(this._jxhr,c,a):g.call(this,c,b,a)}})(window);