/*
 * ----------------------------------------------------------------------
 *  Copyright (C) 2006-2012 Numenta Inc. All rights reserved.
 *
 *  The information and source code contained herein is the
 *  exclusive property of Numenta Inc. No part of this software
 *  may be used, reproduced, stored or distributed in any form,
 *  without explicit written authorization from Numenta Inc.
 * ---------------------------------------------------------------------- */(function(a){var b=a.GROK,c={ENDPOINT:"http://grok-api.numenta.com/",VERSION:"v1",FORCE_PROXY:!1};b.ApiObject=function(a,b){b=b||{},a=a||{},this.setScalars(a),this.setEndpoint(b.endpoint||c.ENDPOINT),this.setProxyEndpoint(b.proxyEndpoint),this.setVersion(b.version||c.VERSION),this.setHeaders(b.httpHeaders||{}),this.setUserId(b.userId),this.setApiKey(b.apiKey)},b.ApiObject.FORCE_PROXY=c.FORCE_PROXY,b.ApiObject.prototype.setScalar=function(a,b){this._scalars[a]=b},b.ApiObject.prototype.setScalars=function(a,b){var c;typeof b=="undefined"&&(b=!0);if(b)this._scalars=a;else for(c in a)this._scalars[c]=a[c]},b.ApiObject.prototype.getScalars=function(){return this._scalars||{}},b.ApiObject.prototype.getScalar=function(a){return this._scalars[a]},b.ApiObject.prototype.setDetails=function(a){this._details=a},b.ApiObject.prototype.setDetail=function(a,b){this._details[a]=b},b.ApiObject.prototype.getDetails=function(){return this._details||{}},b.ApiObject.prototype.getDetail=function(a){return this._details[a]},b.ApiObject.prototype.hasDetails=function(){return b.util.isSet(this._details)},b.ApiObject.prototype.getAttrs=function(){var a=this._scalars,b=this._details,c={},d;for(d in a)a.hasOwnProperty(d)&&d.indexOf("_")!==0&&(c[d]=a[d]);for(d in b)b.hasOwnProperty(d)&&d.indexOf("_")!==0&&(c[d]=b[d]);return c},b.ApiObject.prototype.getAttr=function(a){return this.getAttrs()[a]},b.ApiObject.prototype.get=function(a){var b=this._scalars[a];return!b&&this._details&&(b=this._details[a]),b},b.ApiObject.prototype.getId=function(){return this.get("id")},b.ApiObject.prototype.setEndpoint=function(a){this._apiEndpoint=a},b.ApiObject.prototype.setProxyEndpoint=function(a){this._proxyEndpoint=a},b.ApiObject.prototype.getProxyEndpoint=function(){return this._proxyEndpoint},b.ApiObject.prototype.getEndpoint=function(){return this._apiEndpoint},b.ApiObject.prototype.setVersion=function(a){this._apiVersion=a},b.ApiObject.prototype.getVersion=function(){return this._apiVersion},b.ApiObject.prototype.setUserId=function(a){this._userId=a},b.ApiObject.prototype.getUserId=function(){return this._userId},b.ApiObject.prototype.setApiKey=function(a){this._apiKey=a},b.ApiObject.prototype.getApiKey=function(){return this._apiKey},b.ApiObject.prototype.setHeaders=function(a){this._httpHeaders=a||{}},b.ApiObject.prototype.getHeaders=function(){return this._httpHeaders},b.ApiObject.prototype.expand=function(a,c){b.debug("ApiObject.expand for "+this.constructor.NAMESPACE);var d=this,e=a.NAMESPACE,f=e.substr(0,e.length-1),g=this.get("url");b.debug("Expanding "+f),this.makeRequest({method:"GET",url:g,success:function(a){var b=a[f];d.setDetails(b),c(null,d.getDetails())},failure:function(a){c(a)}})},b.ApiObject.prototype.delete=function(a){b.debug("ApiObject.delete for "+this.constructor.NAMESPACE);var c=this;this.makeRequest({method:"DELETE",url:this.get("url"),success:function(){var b;for(b in c)delete c[b];a()},failure:function(b){a(b)}})},b.ApiObject.prototype.makeRequest=function(c){b.info("GROK.ApiObject.makeRequest for "+this.constructor.NAMESPACE),b.debug(c);var d,e,f=b.util.shallowObjectClone(this._httpHeaders);if(!c.url&&!c.path){e=new Error('Cannot make request without an absolute "url" or relative "path".');if(c.failure){c.failure(e);return}throw e}if(!c.headers)c.headers=f;else for(d in f)c.headers[d]||(c.headers[d]=f[d]);b.util.isSet(c.forceProxy)||(c.forceProxy=b.ApiObject.FORCE_PROXY),(new a.GROK.Request({endpoint:this.getEndpoint(),version:this.getVersion(),apiKey:this.getApiKey(),proxyEndpoint:this.getProxyEndpoint()})).send(c)},b.ApiObject.prototype.listObjects=function(){b.debug("GROK.ApiObject.listObjects for "+this.constructor.NAMESPACE);var a=arguments[0],c=typeof arguments[1]=="function"?{}:arguments[1],d=typeof arguments[1]=="function"?arguments[1]:arguments[2],e=this,f=a.NAMESPACE,g=this.get(f+"Url");this.makeRequest({method:"GET",url:g,data:c,success:function(b){var c=0,g=b[f];for(;c<g.length;c++)g[c]=new a(g[c],e.getDefaultChildOptions()),g[c].setScalar("_parent",e);d(null,g)},failure:function(a){d(a)}})},b.ApiObject.prototype.createObject=function(a,c,d){b.debug("GROK.ApiObject.createObject for "+this.constructor.NAMESPACE);var e=this,f=a.NAMESPACE,g=f.substr(0,f.length-1),h={};h[g]=c,this.makeRequest({method:"POST",url:this.get(f+"Url"),data:h,success:function(b){var c=new a(b[g],e.getDefaultChildOptions());c.setScalar("_parent",e),d(null,c)},failure:function(a){d(a)}})},b.ApiObject.prototype.getObject=function(a,c,d){b.debug("GROK.ApiObject.getObject for "+this.constructor.NAMESPACE);var e=this,f=a.NAMESPACE,g=f.substr(0,f.length-1);this.makeRequest({method:"GET",url:this.get(f+"Url")+"/"+c,success:function(b){d(null,new a(b[g],e.getDefaultChildOptions()))},failure:function(a){d(a)}})},b.ApiObject.prototype.updateObject=function(a,c,d){b.debug("GROK.ApiObject.updateObject for "+this.constructor.NAMESPACE);var e=this,f,g=a.NAMESPACE,h=g.substr(0,g.length-1),i,j={};i=e.getAttrs();for(f in c)c.hasOwnProperty(f)&&(i[f]=c[f]);j[h]=i,this.makeRequest({method:"POST",url:this.get("url"),data:j,success:function(){e.setScalars(i,!1),d()},failure:function(a){d(a)}})},b.ApiObject.prototype.getDefaultChildOptions=function(){return{endpoint:this.getEndpoint(),proxyEndpoint:this.getProxyEndpoint(),version:this.getVersion(),headers:this.getHeaders(),userId:this.getUserId(),apiKey:this.getApiKey()}}})(window);