/*
 * ----------------------------------------------------------------------
 *  Copyright (C) 2006-2012 Numenta Inc. All rights reserved.
 *
 *  The information and source code contained herein is the
 *  exclusive property of Numenta Inc. No part of this software
 *  may be used, reproduced, stored or distributed in any form,
 *  without explicit written authorization from Numenta Inc.
 * ---------------------------------------------------------------------- */(function(a){function c(a,b,c){this.elementId=a,this.model=b,this.options=c||{}}var b=a.GROK;c.prototype.render=function(){var a=this;this.model.getStream(function(b,c){function j(a,b,c){var d=[];return a.shift(),a.forEach(function(a){var f;a.forEach(function(a,g){b.forEach(function(b,c){g===c&&b===e&&(f=a)}),c.forEach(function(c,e){c.name==b[g]&&d.push([e,{timestamp:(new Date(f)).getTime(),value:(new Number(a)).valueOf()}])})})}),d}var d=c.get("dataSources")[0].fields,e,f=[],g,h={},i;if(b&&this.options.onError)return this.options.onError(b);d.forEach(function(a,b){a.dataFormat.dataType==="DATETIME"&&(e=a.name)}),a.model.getOutputData({align:!0,limit:100},function(b,c){if(b)throw b;var d;g=c.shift(),g.forEach(function(a,b){if(a==="ROWID"||a===e)return;if(a==="Average Grok Score"||a==="Grok Score")return;a.indexOf("Temporal Predicted")===0&&(h.name=a,h.index=b),f.push({name:a,data:[]})}),i=c.pop()[h.index],d=j(c,g,f),d.forEach(function(a){var b=a[0],c=a[1].timestamp,d=a[1].value;f[b].data.push([c,d])}),a.chart=new Highcharts.Chart({title:"Grok Predictions",chart:{type:"line",renderTo:a.elementId},xAxis:{type:"datetime"},series:f}),a.model.monitorPredictions({limit:0,startAt:c[c.length-1][1],onUpdate:function(b){var c,d=0,e=a.model.alignOutputData(b);e[1][h.index]=i,i=e.pop()[h.index],c=j(e,g,f),c.forEach(function(b){var c=b[0],d=b[1].timestamp,e=b[1].value;a.chart.series[c].addPoint([d,e])}),a.chart.redraw()},onDone:function(){alert("no more predictions")}})})})},b.charts={PredictionPlotter:c}})(window);